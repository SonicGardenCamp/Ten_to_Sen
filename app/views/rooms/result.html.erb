<div class="container py-5 text-center">
  <h1 class="mb-4">ゲーム結果</h1>

  <div class="row">
    <% @results.each do |user, result| %>
      <div class="col-md-6 mb-4">
        <div class="card">
          <div class="card-header fw-bold bg-<%= user == current_user ? 'primary text-white' : 'secondary text-white' %>">
            <%= user.username %><%= user == current_user ? ' (あなた)' : '' %>
          </div>

          <div class="card-body">
            <p class="display-4 fw-bold text-primary"><%= result[:total_score] %>点</p>
            <p class="text-muted">(基礎点: <%= result[:total_base_score] %> + AIボーナス: <%= result[:total_ai_score] %>)</p>
            <p class="fw-bold">単語数: <%= result[:word_count] %>個</p>
          </div>

          <div class="card-footer">
            <div class="card-header fw-bold">単語履歴</div>
            <div class="card-body" style="max-height: 300px; overflow-y: auto;">
              <% result[:words].each do |word| %>
                <%= turbo_frame_tag "word_evaluation_#{word.id}" do %>
                  <div class="d-flex justify-content-between align-items-center mb-2 border-bottom pb-2">
                    <p class="fs-6 mb-0 text-start"><%= word.body %></p>
                    <div class="text-end">
                      <% if word.score.to_i > 0 %>
                        <span class="badge bg-secondary rounded-pill">基礎: <%= word.score %>点</span>
                      <% end %>
                      <% if word.score.to_i > 0 %>
                        <% if word.ai_score.present? %>
                          <span class="badge bg-info rounded-pill">AI: <%= word.ai_score %>点</span>
                        <% else %>
                          <span class="badge bg-light text-dark rounded-pill">
                            <div class="spinner-border spinner-border-sm" role="status">
                              <span class="visually-hidden">Loading...</span>
                            </div>
                          </span>
                        <% end %>
                      <% end %>
                    </div>
                  </div>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <div class="mt-4">
    <%= button_to "トップに戻る", authenticated_root_path, method: :get, class: 'game-btn' %>
  </div>
</div>
